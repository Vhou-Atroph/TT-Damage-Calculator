name: CI

on:
  push:
    branches:
      - main
    tags:
      - '*'
  pull_request:
  workflow_dispatch:

permissions:
  contents: write

jobs:
    windows-exe:
        runs-on: windows-latest
        strategy:
            fail-fast: false
            matrix:
                target: [x64]
        steps:
            - uses: actions/checkout@v3
            - uses: actions/setup-python@v4
              with:
                python-version: '3.11'
                architecture: ${{ matrix.target }}
            - name: Build .exe
              run: |
                pip install pyinstaller
                cargo build --release
                ren ./target/release/rustygag.dll rustygag.pyd
                move ./target/release/rustygag.pyd ./src/tt_damage_calculator
                pyinstaller "Toontown Damage Calculator.spec"
            - name: Upload .exe
              uses: actions/upload-artifact@v3
              with:
                name: executables
                path: dist